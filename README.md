# On Chain Rock-Paper-Scissors Game

## Game Overview

This is a two-player, commit-reveal Rock-Paper-Scissors game deployed on the Ethereum blockchain.  
Each player participates by creating or joining a "room," and the contract handles fairness using hashed commitments.

---

## Game Logic

### Create Room
Player 1 creates a room with a `commitment`, generated using the `RockPaperScissors.createCommitment(Move, salt)` function.

- `createCommitment` returns a `bytes32` hash encoding Player 1's move and a secret salt.
- This ensures Player 1's move remains hidden from Player 2.

Player 1 then uses the `commitment` to create a game.  
The room state is now set to `State = Waiting`.

### Join Room
Player 2 joins the game by submitting their Move.

- Player 2 directly provides their chosen move.
- The room state changes to `State = Committed`.

### Reveal
Player 1 reveals their original Move and salt.

- The contract verifies the revealed Move and salt match the initial commitment.
- Upon successful verification, the room state changes to `State = Revealed`.

### Final Action
The contract compares the two moves:

- Rock beats Scissors
- Scissors beats Paper
- Paper beats Rock

The winner is determined, and the room state changes to `State = Completed`.  
If both moves are identical, it results in a tie (no winner).

---

## Foundry

**Foundry is a blazing fast, portable, and modular toolkit for Ethereum application development written in Rust.**

Foundry consists of:
- **Forge**: Ethereum testing framework.
- **Cast**: Swiss army knife for interacting with EVM contracts.
- **Anvil**: Local Ethereum node.

Documentation: [Foundry Book](https://book.getfoundry.sh/)

---

## Usage

### Build Project
```bash
forge build
```

### Test Project
```bash
forge test
```

### Format Code
```bash
forge fmt
```

### Local Node (Optional)
```bash
anvil
```

---

## Deployment

Deploy the RockPaperScissors contract to the Ethereum Sepolia Testnet.

1. Create a `.env` file at the project root:

```dotenv
SEPOLIA_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_API_KEY
PRIVATE_KEY=your_metamask_private_key
```

2. Deployment Script: `script/DeployRPS.s.sol`

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Script.sol";
import "../src/RockPaperScissors.sol";

contract DeployRPS is Script {
    function run() external {
        vm.startBroadcast();
        new RockPaperScissors();
        vm.stopBroadcast();
    }
}
```

3. Deploy Command:

Make sure to load environment variables first:

```bash
export $(cat .env | xargs)
```

Then deploy:

```bash
forge script script/DeployRPS.s.sol:DeployRPS --fork-url $SEPOLIA_RPC_URL --private-key $PRIVATE_KEY --broadcast
```

- `--fork-url` forks Sepolia for local simulation.
- `--broadcast` sends the real transaction to Sepolia.
- `--private-key` signs the deployment transaction.

### Example Successful Deployment Output

```
Chain 11155111
Estimated gas price: 0.03 gwei
Estimated gas used: 1,397,357
Amount required: ~0.000055 ETH

[Success]
Hash: 0x...
Contract Address: 0x...
Block: 8201741
Paid: 0.0000215 ETH
```

Deployment artifacts are saved in the `/broadcast/` folder.

---

## Interaction

After deployment, interact with the contract using `cast`.

**Make sure to replace placeholders like `0xYourContractAddress` and `0xYourCommitment`.**

### Create a Game
```bash
cast send 0xYourContractAddress "createGame(bytes32)" 0xYourCommitment --private-key $PRIVATE_KEY --rpc-url $SEPOLIA_RPC_URL
```
- `0xYourCommitment`: the hash generated by `createCommitment`.

### Join a Game
```bash
cast send 0xYourContractAddress "joinGame(uint256,uint8)" 0 1 --private-key $PRIVATE_KEY --rpc-url $SEPOLIA_RPC_URL
```
- `0`: Game ID
- `1`: Move (1 = Rock, 2 = Paper, 3 = Scissors)

### Reveal Moves
```bash
cast send 0xYourContractAddress "revealMoves(uint256,uint8,bytes32)" 0 1 0xYourSalt --private-key $PRIVATE_KEY --rpc-url $SEPOLIA_RPC_URL
```
- `0`: Game ID
- `1`: Your revealed Move
- `0xYourSalt`: the original salt used when creating the commitment.

---

## Help

```bash
forge --help     # General Forge CLI help
anvil --help     # Local node help
cast --help      # Cast CLI help
```

